ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ segment 3: paddr=00030020ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0x1 (POWERON),boot:0x8 (SPI_FAST_FLASH_BOOT)
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (27) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (27) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (27) boot: Multicore bootloader[0m
[0;32mI (30) boot: chip revision: v0.2[0m
[0;32mI (34) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (38) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (43) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (48) boot: Enabling RNG early entropy source...[0m
[0;32mI (53) boot: Partition Table:[0m
[0;32mI (57) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (64) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (72) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (79) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (87) boot: End of partition table[0m
[0;32mI (91) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (116) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (119) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (128) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (161) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (177) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (177) boot: Disabling RNG early entropy source...[0m
[0;32mI (189) cpu_start: Multicore app[0m
[0;32mI (198) cpu_start: Pro cpu start user code[0m
[0;32mI (198) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (199) cpu_start: Application information:[0m
[0;32mI (201) cpu_start: Project name:     esp_node[0m
[0;32mI (206) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (212) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (218) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (223) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (228) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (233) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (238) cpu_start: Chip rev:         v0.2[0m
[0;32mI (243) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (250) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (256) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (262) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (268) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (275) spi_flash: detected chip: gd[0m
[0;32mI (279) spi_flash: flash io: dio[0m
[0;33mW (283) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (296) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (303) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (310) main_task: Started on CPU0[0m
[0;32mI (320) main_task: Calling app_main()[0m
[0;32mI (320) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (330) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (340) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (340) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (350) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (360) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (370) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (370) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (380) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (390) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (400) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (410) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (420) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (430) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (440) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (450) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (460) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (470) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (480) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (500) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22867.75 Hz (bin 281)
  Peak magnitude: 0.02
  Band average: 0.01
  Peak/Average ratio: 1.38

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.78
  Band average: 0.03
  Peak/Average ratio: 29.80

Noise baseline (5-15 kHz):
  Average: 0.01
  Max: 0.02

=== DECISION LOGIC ===
SNR 20kHz band: 1.37 (2.7 dB)
SNR 40kHz band: 60.31 (35.6 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 41585.12 Hz
==============================

Result: 41585 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1080) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1080) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1090) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1110) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1120) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19287.03 Hz (bin 237)
  Peak magnitude: 0.02
  Band average: 0.01
  Peak/Average ratio: 1.96

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.78
  Band average: 0.02
  Peak/Average ratio: 35.86

Noise baseline (5-15 kHz):
  Average: 0.01
  Max: 0.02

=== DECISION LOGIC ===
SNR 20kHz band: 2.42 (7.7 dB)
SNR 40kHz band: 100.14 (40.0 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 41585.12 Hz
==============================

Result: 41585 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1700) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1710) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1720) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1730) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1740) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1750) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22623.61 Hz (bin 278)
  Peak magnitude: 3.01
  Band average: 0.99
  Peak/Average ratio: 3.05

Band 40kHz (37-42 kHz):
  Peak: 40934.08 Hz (bin 503)
  Peak magnitude: 3.16
  Band average: 0.97
  Peak/Average ratio: 3.27

Noise baseline (5-15 kHz):
  Average: 1.00
  Max: 3.00

=== DECISION LOGIC ===
SNR 20kHz band: 3.01 (9.6 dB)
SNR 40kHz band: 3.16 (10.0 dB)

Signal detected at 20kHz: YES
Signal detected at 40kHz: YES

==> WARNING: Both frequencies detected!
    Selecting 40 kHz (stronger signal)
==============================

Result: 40934 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2330) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2340) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2350) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19612.55 Hz (bin 241)
  Peak magnitude: 0.32
  Band average: 0.13
  Peak/Average ratio: 2.49

Band 40kHz (37-42 kHz):
  Peak: 40364.42 Hz (bin 496)
  Peak magnitude: 0.45
  Band average: 0.15
  Peak/Average ratio: 3.04

Noise baseline (5-15 kHz):
  Average: 0.19
  Max: 0.68

=== DECISION LOGIC ===
SNR 20kHz band: 1.72 (4.7 dB)
SNR 40kHz band: 2.40 (7.6 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22867.75 Hz (bin 281)
  Peak magnitude: 0.01
  Band average: 0.00
  Peak/Average ratio: 2.45

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.77
  Band average: 0.02
  Peak/Average ratio: 41.10

Noise baseline (5-15 kHz):
  Average: 0.01
  Max: 0.01

=== DECISION LOGIC ===
SNR 20kHz band: 1.67 (4.5 dB)
SNR 40kHz band: 119.21 (41.5 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 41585.12 Hz
==============================

Result: 41585 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22542.23 Hz (bin 277)
  Peak magnitude: 2.75
  Band average: 1.09
  Peak/Average ratio: 2.53

Band 40kHz (37-42 kHz):
  Peak: 38899.59 Hz (bin 478)
  Peak magnitude: 2.97
  Band average: 0.86
  Peak/Average ratio: 3.45

Noise baseline (5-15 kHz):
  Average: 1.00
  Max: 2.63

=== DECISION LOGIC ===
SNR 20kHz band: 2.75 (8.8 dB)
SNR 40kHz band: 2.97 (9.5 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22053.95 Hz (bin 271)
  Peak magnitude: 0.39
  Band average: 0.17
  Peak/Average ratio: 2.28

Band 40kHz (37-42 kHz):
  Peak: 37841.64 Hz (bin 465)
  Peak magnitude: 0.36
  Band average: 0.16
  Peak/Average ratio: 2.20

Noise baseline (5-15 kHz):
  Average: 0.20
  Max: 0.77

=== DECISION LOGIC ===
SNR 20kHz band: 1.97 (5.9 dB)
SNR 40kHz band: 1.82 (5.2 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19449.79 Hz (bin 239)
  Peak magnitude: 0.01
  Band average: 0.00
  Peak/Average ratio: 1.99

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.78
  Band average: 0.02
  Peak/Average ratio: 44.16

Noise baseline (5-15 kHz):
  Average: 0.00
  Max: 0.01

=== DECISION LOGIC ===
SNR 20kHz band: 2.22 (6.9 dB)
SNR 40kHz band: 190.01 (45.6 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 41585.12 Hz
==============================

Result: 41585 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21728.43 Hz (bin 267)
  Peak magnitude: 4.16
  Band average: 1.54
  Peak/Average ratio: 2.69

Band 40kHz (37-42 kHz):
  Peak: 39957.52 Hz (bin 491)
  Peak magnitude: 5.87
  Band average: 1.59
  Peak/Average ratio: 3.68

Noise baseline (5-15 kHz):
  Average: 1.45
  Max: 3.58

=== DECISION LOGIC ===
SNR 20kHz band: 2.86 (9.1 dB)
SNR 40kHz band: 4.04 (12.1 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 39957.52 Hz
==============================

Result: 39957 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21891.19 Hz (bin 269)
  Peak magnitude: 0.41
  Band average: 0.16
  Peak/Average ratio: 2.49

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.38
  Band average: 0.13
  Peak/Average ratio: 2.80

Noise baseline (5-15 kHz):
  Average: 0.20
  Max: 0.66

=== DECISION LOGIC ===
SNR 20kHz band: 2.09 (6.4 dB)
SNR 40kHz band: 1.93 (5.7 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 18961.51 Hz (bin 233)
  Peak magnitude: 0.31
  Band average: 0.14
  Peak/Average ratio: 2.12

Band 40kHz (37-42 kHz):
  Peak: 40364.42 Hz (bin 496)
  Peak magnitude: 0.57
  Band average: 0.18
  Peak/Average ratio: 3.16

Noise baseline (5-15 kHz):
  Average: 0.18
  Max: 0.61

=== DECISION LOGIC ===
SNR 20kHz band: 1.68 (4.5 dB)
SNR 40kHz band: 3.14 (9.9 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 40364.42 Hz
==============================

Result: 40364 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22542.23 Hz (bin 277)
  Peak magnitude: 4.02
  Band average: 1.25
  Peak/Average ratio: 3.22

Band 40kHz (37-42 kHz):
  Peak: 40934.08 Hz (bin 503)
  Peak magnitude: 4.59
  Band average: 1.38
  Peak/Average ratio: 3.33

Noise baseline (5-15 kHz):
  Average: 1.12
  Max: 4.40

=== DECISION LOGIC ===
SNR 20kHz band: 3.59 (11.1 dB)
SNR 40kHz band: 4.10 (12.3 dB)

Signal detected at 20kHz: YES
Signal detected at 40kHz: YES

==> WARNING: Both frequencies detected!
    Selecting 40 kHz (stronger signal)
==============================

Result: 40934 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19938.07 Hz (bin 245)
  Peak magnitude: 0.35
  Band average: 0.15
  Peak/Average ratio: 2.39

Band 40kHz (37-42 kHz):
  Peak: 39713.38 Hz (bin 488)
  Peak magnitude: 0.40
  Band average: 0.16
  Peak/Average ratio: 2.53

Noise baseline (5-15 kHz):
  Average: 0.17
  Max: 0.62

=== DECISION LOGIC ===
SNR 20kHz band: 2.12 (6.5 dB)
SNR 40kHz band: 2.42 (7.7 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19124.27 Hz (bin 235)
  Peak magnitude: 0.38
  Band average: 0.16
  Peak/Average ratio: 2.41

Band 40kHz (37-42 kHz):
  Peak: 37109.23 Hz (bin 456)
  Peak magnitude: 0.39
  Band average: 0.17
  Peak/Average ratio: 2.30

Noise baseline (5-15 kHz):
  Average: 0.20
  Max: 0.62

=== DECISION LOGIC ===
SNR 20kHz band: 1.90 (5.6 dB)
SNR 40kHz band: 1.96 (5.8 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19042.89 Hz (bin 234)
  Peak magnitude: 2.91
  Band average: 1.46
  Peak/Average ratio: 2.00

Band 40kHz (37-42 kHz):
  Peak: 39957.52 Hz (bin 491)
  Peak magnitude: 4.88
  Band average: 1.83
  Peak/Average ratio: 2.67

Noise baseline (5-15 kHz):
  Average: 1.27
  Max: 3.24

=== DECISION LOGIC ===
SNR 20kHz band: 2.29 (7.2 dB)
SNR 40kHz band: 3.83 (11.7 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 39957.52 Hz
==============================

Result: 39957 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19205.65 Hz (bin 236)
  Peak magnitude: 0.49
  Band average: 0.21
  Peak/Average ratio: 2.37

Band 40kHz (37-42 kHz):
  Peak: 39143.72 Hz (bin 481)
  Peak magnitude: 0.48
  Band average: 0.17
  Peak/Average ratio: 2.75

Noise baseline (5-15 kHz):
  Average: 0.18
  Max: 0.66

=== DECISION LOGIC ===
SNR 20kHz band: 2.69 (8.6 dB)
SNR 40kHz band: 2.61 (8.3 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19042.89 Hz (bin 234)
  Peak magnitude: 0.41
  Band average: 0.15
  Peak/Average ratio: 2.81

Band 40kHz (37-42 kHz):
  Peak: 38492.68 Hz (bin 473)
  Peak magnitude: 0.44
  Band average: 0.20
  Peak/Average ratio: 2.19

Noise baseline (5-15 kHz):
  Average: 0.17
  Max: 0.69

=== DECISION LOGIC ===
SNR 20kHz band: 2.37 (7.5 dB)
SNR 40kHz band: 2.53 (8.1 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19205.65 Hz (bin 236)
  Peak magnitude: 2.93
  Band average: 0.94
  Peak/Average ratio: 3.11

Band 40kHz (37-42 kHz):
  Peak: 40852.70 Hz (bin 502)
  Peak magnitude: 1.45
  Band average: 0.67
  Peak/Average ratio: 2.17

Noise baseline (5-15 kHz):
  Average: 0.70
  Max: 1.95

=== DECISION LOGIC ===
SNR 20kHz band: 4.16 (12.4 dB)
SNR 40kHz band: 2.06 (6.3 dB)

Signal detected at 20kHz: YES
Signal detected at 40kHz: NO

==> DETECTED: 20 kHz TRANSDUCER ACTIVE
    Frequency: 19205.65 Hz
==============================

Result: 19205 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19856.69 Hz (bin 244)
  Peak magnitude: 0.42
  Band average: 0.17
  Peak/Average ratio: 2.54

Band 40kHz (37-42 kHz):
  Peak: 41340.98 Hz (bin 508)
  Peak magnitude: 0.39
  Band average: 0.19
  Peak/Average ratio: 2.00

Noise baseline (5-15 kHz):
  Average: 0.22
  Max: 0.80

=== DECISION LOGIC ===
SNR 20kHz band: 1.96 (5.9 dB)
SNR 40kHz band: 1.79 (5.1 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 20344.97 Hz (bin 250)
  Peak magnitude: 0.38
  Band average: 0.18
  Peak/Average ratio: 2.09

Band 40kHz (37-42 kHz):
  Peak: 39062.34 Hz (bin 480)
  Peak magnitude: 0.41
  Band average: 0.17
  Peak/Average ratio: 2.39

Noise baseline (5-15 kHz):
  Average: 0.20
  Max: 0.67

=== DECISION LOGIC ===
SNR 20kHz band: 1.93 (5.7 dB)
SNR 40kHz band: 2.06 (6.3 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21809.81 Hz (bin 268)
  Peak magnitude: 2.75
  Band average: 1.35
  Peak/Average ratio: 2.04

Band 40kHz (37-42 kHz):
  Peak: 39957.52 Hz (bin 491)
  Peak magnitude: 2.74
  Band average: 1.47
  Peak/Average ratio: 1.86

Noise baseline (5-15 kHz):
  Average: 1.22
  Max: 3.01

=== DECISION LOGIC ===
SNR 20kHz band: 2.26 (7.1 dB)
SNR 40kHz band: 2.25 (7.0 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21891.19 Hz (bin 269)
  Peak magnitude: 0.37
  Band average: 0.16
  Peak/Average ratio: 2.30

Band 40kHz (37-42 kHz):
  Peak: 38492.68 Hz (bin 473)
  Peak magnitude: 0.42
  Band average: 0.15
  Peak/Average ratio: 2.88

Noise baseline (5-15 kHz):
  Average: 0.17
  Max: 0.66

=== DECISION LOGIC ===
SNR 20kHz band: 2.17 (6.7 dB)
SNR 40kHz band: 2.47 (7.8 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21565.67 Hz (bin 265)
  Peak magnitude: 0.48
  Band average: 0.22
  Peak/Average ratio: 2.22

Band 40kHz (37-42 kHz):
  Peak: 40608.56 Hz (bin 499)
  Peak magnitude: 0.46
  Band average: 0.21
  Peak/Average ratio: 2.22

Noise baseline (5-15 kHz):
  Average: 0.25
  Max: 0.74

=== DECISION LOGIC ===
SNR 20kHz band: 1.92 (5.7 dB)
SNR 40kHz band: 1.80 (5.1 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22623.61 Hz (bin 278)
  Peak magnitude: 3.29
  Band average: 1.32
  Peak/Average ratio: 2.48

Band 40kHz (37-42 kHz):
  Peak: 40934.08 Hz (bin 503)
  Peak magnitude: 3.78
  Band average: 1.33
  Peak/Average ratio: 2.83

Noise baseline (5-15 kHz):
  Average: 1.54
  Max: 4.30

=== DECISION LOGIC ===
SNR 20kHz band: 2.13 (6.6 dB)
SNR 40kHz band: 2.45 (7.8 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21891.19 Hz (bin 269)
  Peak magnitude: 0.33
  Band average: 0.15
  Peak/Average ratio: 2.26

Band 40kHz (37-42 kHz):
  Peak: 39062.34 Hz (bin 480)
  Peak magnitude: 0.49
  Band average: 0.18
  Peak/Average ratio: 2.63

Noise baseline (5-15 kHz):
  Average: 0.18
  Max: 0.57

=== DECISION LOGIC ===
SNR 20kHz band: 1.79 (5.0 dB)
SNR 40kHz band: 2.63 (8.4 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22460.85 Hz (bin 276)
  Peak magnitude: 0.48
  Band average: 0.15
  Peak/Average ratio: 3.22

Band 40kHz (37-42 kHz):
  Peak: 37109.23 Hz (bin 456)
  Peak magnitude: 0.35
  Band average: 0.17
  Peak/Average ratio: 2.11

Noise baseline (5-15 kHz):
  Average: 0.20
  Max: 0.65

=== DECISION LOGIC ===
SNR 20kHz band: 2.40 (7.6 dB)
SNR 40kHz band: 1.76 (4.9 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19856.69 Hz (bin 244)
  Peak magnitude: 2.58
  Band average: 1.37
  Peak/Average ratio: 1.89

Band 40kHz (37-42 kHz):
  Peak: 39957.52 Hz (bin 491)
  Peak magnitude: 7.04
  Band average: 1.52
  Peak/Average ratio: 4.64

Noise baseline (5-15 kHz):
  Average: 1.45
  Max: 3.88

=== DECISION LOGIC ===
SNR 20kHz band: 1.78 (5.0 dB)
SNR 40kHz band: 4.85 (13.7 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 39957.52 Hz
==============================

Result: 39957 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22623.61 Hz (bin 278)
  Peak magnitude: 0.28
  Band average: 0.14
  Peak/Average ratio: 1.92

Band 40kHz (37-42 kHz):
  Peak: 39794.76 Hz (bin 489)
  Peak magnitude: 0.43
  Band average: 0.16
  Peak/Average ratio: 2.71

Noise baseline (5-15 kHz):
  Average: 0.22
  Max: 0.69

=== DECISION LOGIC ===
SNR 20kHz band: 1.28 (2.2 dB)
SNR 40kHz band: 1.98 (5.9 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19531.17 Hz (bin 240)
  Peak magnitude: 0.40
  Band average: 0.20
  Peak/Average ratio: 2.03

Band 40kHz (37-42 kHz):
  Peak: 41015.46 Hz (bin 504)
  Peak magnitude: 0.42
  Band average: 0.19
  Peak/Average ratio: 2.16

Noise baseline (5-15 kHz):
  Average: 0.20
  Max: 0.58

=== DECISION LOGIC ===
SNR 20kHz band: 2.00 (6.0 dB)
SNR 40kHz band: 2.08 (6.3 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21728.43 Hz (bin 267)
  Peak magnitude: 4.70
  Band average: 1.54
  Peak/Average ratio: 3.06

Band 40kHz (37-42 kHz):
  Peak: 39957.52 Hz (bin 491)
  Peak magnitude: 5.74
  Band average: 1.80
  Peak/Average ratio: 3.20

Noise baseline (5-15 kHz):
  Average: 1.16
  Max: 3.77

=== DECISION LOGIC ===
SNR 20kHz band: 4.04 (12.1 dB)
SNR 40kHz band: 4.93 (13.9 dB)

Signal detected at 20kHz: YES
Signal detected at 40kHz: YES

==> WARNING: Both frequencies detected!
    Selecting 40 kHz (stronger signal)
==============================

Result: 39957 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19938.07 Hz (bin 245)
  Peak magnitude: 0.39
  Band average: 0.15
  Peak/Average ratio: 2.67

Band 40kHz (37-42 kHz):
  Peak: 38004.41 Hz (bin 467)
  Peak magnitude: 0.42
  Band average: 0.16
  Peak/Average ratio: 2.69

Noise baseline (5-15 kHz):
  Average: 0.23
  Max: 0.75

=== DECISION LOGIC ===
SNR 20kHz band: 1.70 (4.6 dB)
SNR 40kHz band: 1.85 (5.3 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19205.65 Hz (bin 236)
  Peak magnitude: 0.30
  Band average: 0.13
  Peak/Average ratio: 2.21

Band 40kHz (37-42 kHz):
  Peak: 39143.72 Hz (bin 481)
  Peak magnitude: 0.34
  Band average: 0.14
  Peak/Average ratio: 2.34

Noise baseline (5-15 kHz):
  Average: 0.22
  Max: 0.68

=== DECISION LOGIC ===
SNR 20kHz band: 1.37 (2.8 dB)
SNR 40kHz band: 1.56 (3.8 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21647.05 Hz (bin 266)
  Peak magnitude: 3.57
  Band average: 1.80
  Peak/Average ratio: 1.98

Band 40kHz (37-42 kHz):
  Peak: 39957.52 Hz (bin 491)
  Peak magnitude: 7.65
  Band average: 2.13
  Peak/Average ratio: 3.59

Noise baseline (5-15 kHz):
  Average: 1.63
  Max: 6.13

=== DECISION LOGIC ===
SNR 20kHz band: 2.19 (6.8 dB)
SNR 40kHz band: 4.69 (13.4 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 39957.52 Hz
==============================

Result: 39957 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22704.99 Hz (bin 279)
  Peak magnitude: 0.47
  Band average: 0.18
  Peak/Average ratio: 2.65

Band 40kHz (37-42 kHz):
  Peak: 39550.62 Hz (bin 486)
  Peak magnitude: 0.34
  Band average: 0.16
  Peak/Average ratio: 2.12

Noise baseline (5-15 kHz):
  Average: 0.22
  Max: 0.93

=== DECISION LOGIC ===
SNR 20kHz band: 2.14 (6.6 dB)
SNR 40kHz band: 1.57 (3.9 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19287.03 Hz (bin 237)
  Peak magnitude: 0.51
  Band average: 0.21
  Peak/Average ratio: 2.40

Band 40kHz (37-42 kHz):
  Peak: 40364.42 Hz (bin 496)
  Peak magnitude: 0.51
  Band average: 0.20
  Peak/Average ratio: 2.51

Noise baseline (5-15 kHz):
  Average: 0.22
  Max: 0.69

=== DECISION LOGIC ===
SNR 20kHz band: 2.28 (7.2 dB)
SNR 40kHz band: 2.30 (7.2 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22623.61 Hz (bin 278)
  Peak magnitude: 3.88
  Band average: 1.27
  Peak/Average ratio: 3.05

Band 40kHz (37-42 kHz):
  Peak: 39957.52 Hz (bin 491)
  Peak magnitude: 4.86
  Band average: 1.52
  Peak/Average ratio: 3.19

Noise baseline (5-15 kHz):
  Average: 1.12
  Max: 3.67

=== DECISION LOGIC ===
SNR 20kHz band: 3.46 (10.8 dB)
SNR 40kHz band: 4.34 (12.7 dB)

Signal detected at 20kHz: YES
Signal detected at 40kHz: YES

==> WARNING: Both frequencies detected!
    Selecting 40 kHz (stronger signal)
==============================

Result: 39957 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21565.67 Hz (bin 265)
  Peak magnitude: 0.30
  Band average: 0.16
  Peak/Average ratio: 1.94

Band 40kHz (37-42 kHz):
  Peak: 40364.42 Hz (bin 496)
  Peak magnitude: 0.42
  Band average: 0.18
  Peak/Average ratio: 2.31

Noise baseline (5-15 kHz):
  Average: 0.20
  Max: 0.55

=== DECISION LOGIC ===
SNR 20kHz band: 1.56 (3.9 dB)
SNR 40kHz band: 2.14 (6.6 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21565.67 Hz (bin 265)
  Peak magnitude: 0.57
  Band average: 0.18
  Peak/Average ratio: 3.19

Band 40kHz (37-42 kHz):
  Peak: 39062.34 Hz (bin 480)
  Peak magnitude: 0.45
  Band average: 0.17
  Peak/Average ratio: 2.69

Noise baseline (5-15 kHz):
  Average: 0.21
  Max: 0.67

=== DECISION LOGIC ===
SNR 20kHz band: 2.74 (8.7 dB)
SNR 40kHz band: 2.17 (6.7 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21240.15 Hz (bin 261)
  Peak magnitude: 2.60
  Band average: 1.08
  Peak/Average ratio: 2.42

Band 40kHz (37-42 kHz):
  Peak: 37516.12 Hz (bin 461)
  Peak magnitude: 3.17
  Band average: 1.31
  Peak/Average ratio: 2.42

Noise baseline (5-15 kHz):
  Average: 1.24
  Max: 3.00

=== DECISION LOGIC ===
SNR 20kHz band: 2.10 (6.4 dB)
SNR 40kHz band: 2.56 (8.2 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 20019.45 Hz (bin 246)
  Peak magnitude: 0.45
  Band average: 0.16
  Peak/Average ratio: 2.79

Band 40kHz (37-42 kHz):
  Peak: 37841.64 Hz (bin 465)
  Peak magnitude: 0.35
  Band average: 0.16
  Peak/Average ratio: 2.20

Noise baseline (5-15 kHz):
  Average: 0.20
  Max: 0.69

=== DECISION LOGIC ===
SNR 20kHz band: 2.28 (7.2 dB)
SNR 40kHz band: 1.79 (5.1 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 20507.73 Hz (bin 252)
  Peak magnitude: 0.47
  Band average: 0.16
  Peak/Average ratio: 2.94

Band 40kHz (37-42 kHz):
  Peak: 41015.46 Hz (bin 504)
  Peak magnitude: 0.49
  Band average: 0.15
  Peak/Average ratio: 3.13

Noise baseline (5-15 kHz):
  Average: 0.18
  Max: 0.78

=== DECISION LOGIC ===
SNR 20kHz band: 2.57 (8.2 dB)
SNR 40kHz band: 2.64 (8.4 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22786.37 Hz (bin 280)
  Peak magnitude: 3.33
  Band average: 1.43
  Peak/Average ratio: 2.32

Band 40kHz (37-42 kHz):
  Peak: 39957.52 Hz (bin 491)
  Peak magnitude: 5.90
  Band average: 1.70
  Peak/Average ratio: 3.47

Noise baseline (5-15 kHz):
  Average: 1.47
  Max: 3.96

=== DECISION LOGIC ===
SNR 20kHz band: 2.26 (7.1 dB)
SNR 40kHz band: 4.01 (12.1 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 39957.52 Hz
==============================

Result: 39957 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 20019.45 Hz (bin 246)
  Peak magnitude: 0.34
  Band average: 0.15
  Peak/Average ratio: 2.23

Band 40kHz (37-42 kHz):
  Peak: 38492.68 Hz (bin 473)
  Peak magnitude: 0.46
  Band average: 0.18
  Peak/Average ratio: 2.59

Noise baseline (5-15 kHz):
  Average: 0.19
  Max: 0.55

=== DECISION LOGIC ===
SNR 20kHz band: 1.82 (5.2 dB)
SNR 40kHz band: 2.48 (7.9 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 18961.51 Hz (bin 233)
  Peak magnitude: 0.42
  Band average: 0.19
  Peak/Average ratio: 2.17

Band 40kHz (37-42 kHz):
  Peak: 39794.76 Hz (bin 489)
  Peak magnitude: 0.51
  Band average: 0.19
  Peak/Average ratio: 2.67

Noise baseline (5-15 kHz):
  Average: 0.20
  Max: 0.74

=== DECISION LOGIC ===
SNR 20kHz band: 2.14 (6.6 dB)
SNR 40kHz band: 2.57 (8.2 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19775.31 Hz (bin 243)
  Peak magnitude: 4.08
  Band average: 1.72
  Peak/Average ratio: 2.37

Band 40kHz (37-42 kHz):
  Peak: 39957.52 Hz (bin 491)
  Peak magnitude: 5.44
  Band average: 2.00
  Peak/Average ratio: 2.73

Noise baseline (5-15 kHz):
  Average: 1.79
  Max: 4.26

=== DECISION LOGIC ===
SNR 20kHz band: 2.28 (7.1 dB)
SNR 40kHz band: 3.04 (9.6 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 39957.52 Hz
==============================

Result: 39957 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22379.47 Hz (bin 275)
  Peak magnitude: 0.39
  Band average: 0.17
  Peak/Average ratio: 2.28

Band 40kHz (37-42 kHz):
  Peak: 38492.68 Hz (bin 473)
  Peak magnitude: 0.59
  Band average: 0.18
  Peak/Average ratio: 3.26

Noise baseline (5-15 kHz):
  Average: 0.18
  Max: 0.65

=== DECISION LOGIC ===
SNR 20kHz band: 2.22 (6.9 dB)
SNR 40kHz band: 3.35 (10.5 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 38492.68 Hz
==============================

Result: 38492 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1084) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1124) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21728.43 Hz (bin 267)
  Peak magnitude: 0.38
  Band average: 0.20
  Peak/Average ratio: 1.86

Band 40kHz (37-42 kHz):
  Peak: 37190.61 Hz (bin 457)
  Peak magnitude: 0.44
  Band average: 0.19
  Peak/Average ratio: 2.36

Noise baseline (5-15 kHz):
  Average: 0.22
  Max: 0.59

=== DECISION LOGIC ===
SNR 20kHz band: 1.69 (4.5 dB)
SNR 40kHz band: 1.98 (5.9 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1704) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1714) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1724) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1754) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19205.65 Hz (bin 236)
  Peak magnitude: 3.04
  Band average: 1.17
  Peak/Average ratio: 2.59

Band 40kHz (37-42 kHz):
  Peak: 39957.52 Hz (bin 491)
  Peak magnitude: 3.59
  Band average: 1.30
  Peak/Average ratio: 2.77

Noise baseline (5-15 kHz):
  Average: 1.41
  Max: 3.10

=== DECISION LOGIC ===
SNR 20kHz band: 2.15 (6.7 dB)
SNR 40kHz band: 2.54 (8.1 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2344) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2354) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 18961.51 Hz (bin 233)
  Peak magnitude: 0.32
  Band average: 0.15
  Peak/Average ratio: 2.15

Band 40kHz (37-42 kHz):
  Peak: 38492.68 Hz (bin 473)
  Peak magnitude: 0.43
  Band average: 0.18
  Peak/Average ratio: 2.39

Noise baseline (5-15 kHz):
  Average: 0.19
  Max: 0.72

=== DECISION LOGIC ===
SNR 20kHz band: 1.72 (4.7 dB)
SNR 40kHz band: 2.28 (7.2 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21565.67 Hz (bin 265)
  Peak magnitude: 0.48
  Band average: 0.17
  Peak/Average ratio: 2.78

Band 40kHz (37-42 kHz):
  Peak: 36946.47 Hz (bin 454)
  Peak magnitude: 0.36
  Band average: 0.19
  Peak/Average ratio: 1.92

Noise baseline (5-15 kHz):
  Average: 0.19
  Max: 0.52

=== DECISION LOGIC ===
SNR 20kHz band: 2.48 (7.9 dB)
SNR 40kHz band: 1.86 (5.4 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19287.03 Hz (bin 237)
  Peak magnitude: 4.44
  Band average: 1.55
  Peak/Average ratio: 2.86

Band 40kHz (37-42 kHz):
  Peak: 39957.52 Hz (bin 491)
  Peak magnitude: 7.21
  Band average: 1.99
  Peak/Average ratio: 3.62

Noise baseline (5-15 kHz):
  Average: 1.71
  Max: 5.52

=== DECISION LOGIC ===
SNR 20kHz band: 2.60 (8.3 dB)
SNR 40kHz band: 4.22 (12.5 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 39957.52 Hz
==============================

Result: 39957 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21565.67 Hz (bin 265)
  Peak magnitude: 0.47
  Band average: 0.17
  Peak/Average ratio: 2.82

Band 40kHz (37-42 kHz):
  Peak: 38411.30 Hz (bin 472)
  Peak magnitude: 0.48
  Band average: 0.16
  Peak/Average ratio: 2.89

Noise baseline (5-15 kHz):
  Average: 0.21
  Max: 0.66

=== DECISION LOGIC ===
SNR 20kHz band: 2.25 (7.0 dB)
SNR 40kHz band: 2.29 (7.2 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22867.75 Hz (bin 281)
  Peak magnitude: 0.41
  Band average: 0.16
  Peak/Average ratio: 2.54

Band 40kHz (37-42 kHz):
  Peak: 40364.42 Hz (bin 496)
  Peak magnitude: 0.44
  Band average: 0.20
  Peak/Average ratio: 2.22

Noise baseline (5-15 kHz):
  Average: 0.22
  Max: 0.83

=== DECISION LOGIC ===
SNR 20kHz band: 1.90 (5.6 dB)
SNR 40kHz band: 2.01 (6.1 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 20670.49 Hz (bin 254)
  Peak magnitude: 5.87
  Band average: 2.00
  Peak/Average ratio: 2.94

Band 40kHz (37-42 kHz):
  Peak: 39957.52 Hz (bin 491)
  Peak magnitude: 8.29
  Band average: 2.17
  Peak/Average ratio: 3.82

Noise baseline (5-15 kHz):
  Average: 1.75
  Max: 6.19

=== DECISION LOGIC ===
SNR 20kHz band: 3.36 (10.5 dB)
SNR 40kHz band: 4.74 (13.5 dB)

Signal detected at 20kHz: YES
Signal detected at 40kHz: YES

==> WARNING: Both frequencies detected!
    Selecting 40 kHz (stronger signal)
==============================

Result: 39957 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21565.67 Hz (bin 265)
  Peak magnitude: 0.37
  Band average: 0.16
  Peak/Average ratio: 2.34

Band 40kHz (37-42 kHz):
  Peak: 37190.61 Hz (bin 457)
  Peak magnitude: 0.31
  Band average: 0.15
  Peak/Average ratio: 2.11

Noise baseline (5-15 kHz):
  Average: 0.18
  Max: 0.49

=== DECISION LOGIC ===
SNR 20kHz band: 2.13 (6.6 dB)
SNR 40kHz band: 1.78 (5.0 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 20263.59 Hz (bin 249)
  Peak magnitude: 0.35
  Band average: 0.17
  Peak/Average ratio: 2.05

Band 40kHz (37-42 kHz):
  Peak: 37190.61 Hz (bin 457)
  Peak magnitude: 0.42
  Band average: 0.18
  Peak/Average ratio: 2.34

Noise baseline (5-15 kHz):
  Average: 0.20
  Max: 0.58

=== DECISION LOGIC ===
SNR 20kHz band: 1.73 (4.7 dB)
SNR 40kHz band: 2.04 (6.2 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21728.43 Hz (bin 267)
  Peak magnitude: 3.92
  Band average: 1.31
  Peak/Average ratio: 2.98

Band 40kHz (37-42 kHz):
  Peak: 39876.14 Hz (bin 490)
  Peak magnitude: 3.64
  Band average: 1.20
  Peak/Average ratio: 3.03

Noise baseline (5-15 kHz):
  Average: 1.20
  Max: 2.91

=== DECISION LOGIC ===
SNR 20kHz band: 3.26 (10.3 dB)
SNR 40kHz band: 3.02 (9.6 dB)

Signal detected at 20kHz: YES
Signal detected at 40kHz: YES

==> WARNING: Both frequencies detected!
    Selecting 20 kHz (stronger signal)
==============================

Result: 21728 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19287.03 Hz (bin 237)
  Peak magnitude: 0.43
  Band average: 0.13
  Peak/Average ratio: 3.23

Band 40kHz (37-42 kHz):
  Peak: 39713.38 Hz (bin 488)
  Peak magnitude: 0.54
  Band average: 0.15
  Peak/Average ratio: 3.54

Noise baseline (5-15 kHz):
  Average: 0.20
  Max: 0.64

=== DECISION LOGIC ===
SNR 20kHz band: 2.18 (6.8 dB)
SNR 40kHz band: 2.74 (8.8 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21240.15 Hz (bin 261)
  Peak magnitude: 0.33
  Band average: 0.17
  Peak/Average ratio: 1.97

Band 40kHz (37-42 kHz):
  Peak: 40201.66 Hz (bin 494)
  Peak magnitude: 0.45
  Band average: 0.16
  Peak/Average ratio: 2.87

Noise baseline (5-15 kHz):
  Average: 0.18
  Max: 0.53

=== DECISION LOGIC ===
SNR 20kHz band: 1.82 (5.2 dB)
SNR 40kHz band: 2.50 (8.0 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 20670.49 Hz (bin 254)
  Peak magnitude: 5.05
  Band average: 1.69
  Peak/Average ratio: 3.00

Band 40kHz (37-42 kHz):
  Peak: 38899.59 Hz (bin 478)
  Peak magnitude: 5.02
  Band average: 1.71
  Peak/Average ratio: 2.94

Noise baseline (5-15 kHz):
  Average: 1.53
  Max: 4.68

=== DECISION LOGIC ===
SNR 20kHz band: 3.30 (10.4 dB)
SNR 40kHz band: 3.28 (10.3 dB)

Signal detected at 20kHz: YES
Signal detected at 40kHz: YES

==> WARNING: Both frequencies detected!
    Selecting 20 kHz (stronger signal)
==============================

Result: 20670 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22135.33 Hz (bin 272)
  Peak magnitude: 0.34
  Band average: 0.16
  Peak/Average ratio: 2.13

Band 40kHz (37-42 kHz):
  Peak: 39713.38 Hz (bin 488)
  Peak magnitude: 0.51
  Band average: 0.21
  Peak/Average ratio: 2.43

Noise baseline (5-15 kHz):
  Average: 0.22
  Max: 0.72

=== DECISION LOGIC ===
SNR 20kHz band: 1.58 (4.0 dB)
SNR 40kHz band: 2.33 (7.3 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19287.03 Hz (bin 237)
  Peak magnitude: 0.68
  Band average: 0.20
  Peak/Average ratio: 3.39

Band 40kHz (37-42 kHz):
  Peak: 40120.28 Hz (bin 493)
  Peak magnitude: 0.46
  Band average: 0.19
  Peak/Average ratio: 2.34

Noise baseline (5-15 kHz):
  Average: 0.19
  Max: 0.66

=== DECISION LOGIC ===
SNR 20kHz band: 3.50 (10.9 dB)
SNR 40kHz band: 2.34 (7.4 dB)

Signal detected at 20kHz: YES
Signal detected at 40kHz: NO

==> DETECTED: 20 kHz TRANSDUCER ACTIVE
    Frequency: 19287.03 Hz
==============================

Result: 19287 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19287.03 Hz (bin 237)
  Peak magnitude: 3.99
  Band average: 1.78
  Peak/Average ratio: 2.24

Band 40kHz (37-42 kHz):
  Peak: 38980.96 Hz (bin 479)
  Peak magnitude: 3.32
  Band average: 1.71
  Peak/Average ratio: 1.95

Noise baseline (5-15 kHz):
  Average: 1.46
  Max: 3.18

=== DECISION LOGIC ===
SNR 20kHz band: 2.74 (8.8 dB)
SNR 40kHz band: 2.28 (7.2 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22460.85 Hz (bin 276)
  Peak magnitude: 0.32
  Band average: 0.14
  Peak/Average ratio: 2.31

Band 40kHz (37-42 kHz):
  Peak: 40283.04 Hz (bin 495)
  Peak magnitude: 0.34
  Band average: 0.16
  Peak/Average ratio: 2.11

Noise baseline (5-15 kHz):
  Average: 0.21
  Max: 0.55

=== DECISION LOGIC ===
SNR 20kHz band: 1.51 (3.6 dB)
SNR 40kHz band: 1.61 (4.1 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19368.41 Hz (bin 238)
  Peak magnitude: 0.64
  Band average: 0.20
  Peak/Average ratio: 3.20

Band 40kHz (37-42 kHz):
  Peak: 38411.30 Hz (bin 472)
  Peak magnitude: 0.41
  Band average: 0.19
  Peak/Average ratio: 2.20

Noise baseline (5-15 kHz):
  Average: 0.21
  Max: 0.62

=== DECISION LOGIC ===
SNR 20kHz band: 3.03 (9.6 dB)
SNR 40kHz band: 1.93 (5.7 dB)

Signal detected at 20kHz: YES
Signal detected at 40kHz: NO

==> DETECTED: 20 kHz TRANSDUCER ACTIVE
    Frequency: 19368.41 Hz
==============================

Result: 19368 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21728.43 Hz (bin 267)
  Peak magnitude: 5.62
  Band average: 1.65
  Peak/Average ratio: 3.41

Band 40kHz (37-42 kHz):
  Peak: 40934.08 Hz (bin 503)
  Peak magnitude: 5.20
  Band average: 1.73
  Peak/Average ratio: 3.01

Noise baseline (5-15 kHz):
  Average: 1.69
  Max: 5.06

=== DECISION LOGIC ===
SNR 20kHz band: 3.33 (10.5 dB)
SNR 40kHz band: 3.08 (9.8 dB)

Signal detected at 20kHz: YES
Signal detected at 40kHz: YES

==> WARNING: Both frequencies detected!
    Selecting 20 kHz (stronger signal)
==============================

Result: 21728 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22867.75 Hz (bin 281)
  Peak magnitude: 0.39
  Band average: 0.14
  Peak/Average ratio: 2.85

Band 40kHz (37-42 kHz):
  Peak: 40852.70 Hz (bin 502)
  Peak magnitude: 0.39
  Band average: 0.17
  Peak/Average ratio: 2.25

Noise baseline (5-15 kHz):
  Average: 0.21
  Max: 0.63

=== DECISION LOGIC ===
SNR 20kHz band: 1.86 (5.4 dB)
SNR 40kHz band: 1.87 (5.4 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19693.93 Hz (bin 242)
  Peak magnitude: 0.39
  Band average: 0.18
  Peak/Average ratio: 2.22

Band 40kHz (37-42 kHz):
  Peak: 40364.42 Hz (bin 496)
  Peak magnitude: 0.37
  Band average: 0.18
  Peak/Average ratio: 2.07

Noise baseline (5-15 kHz):
  Average: 0.19
  Max: 0.65

=== DECISION LOGIC ===
SNR 20kHz band: 2.03 (6.1 dB)
SNR 40kHz band: 1.92 (5.7 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19205.65 Hz (bin 236)
  Peak magnitude: 2.99
  Band average: 1.24
  Peak/Average ratio: 2.41

Band 40kHz (37-42 kHz):
  Peak: 39957.52 Hz (bin 491)
  Peak magnitude: 5.27
  Band average: 1.48
  Peak/Average ratio: 3.56

Noise baseline (5-15 kHz):
  Average: 1.16
  Max: 2.89

=== DECISION LOGIC ===
SNR 20kHz band: 2.58 (8.2 dB)
SNR 40kHz band: 4.54 (13.1 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 39957.52 Hz
==============================

Result: 39957 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22460.85 Hz (bin 276)
  Peak magnitude: 0.39
  Band average: 0.14
  Peak/Average ratio: 2.88

Band 40kHz (37-42 kHz):
  Peak: 41178.22 Hz (bin 506)
  Peak magnitude: 0.37
  Band average: 0.15
  Peak/Average ratio: 2.40

Noise baseline (5-15 kHz):
  Average: 0.19
  Max: 0.59

=== DECISION LOGIC ===
SNR 20kHz band: 2.03 (6.1 dB)
SNR 40kHz band: 1.90 (5.6 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21565.67 Hz (bin 265)
  Peak magnitude: 0.44
  Band average: 0.18
  Peak/Average ratio: 2.45

Band 40kHz (37-42 kHz):
  Peak: 37841.64 Hz (bin 465)
  Peak magnitude: 0.38
  Band average: 0.17
  Peak/Average ratio: 2.28

Noise baseline (5-15 kHz):
  Average: 0.18
  Max: 0.63

=== DECISION LOGIC ===
SNR 20kHz band: 2.46 (7.8 dB)
SNR 40kHz band: 2.15 (6.7 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22704.99 Hz (bin 279)
  Peak magnitude: 4.23
  Band average: 1.61
  Peak/Average ratio: 2.63

Band 40kHz (37-42 kHz):
  Peak: 39957.52 Hz (bin 491)
  Peak magnitude: 7.11
  Band average: 1.61
  Peak/Average ratio: 4.41

Noise baseline (5-15 kHz):
  Average: 1.67
  Max: 4.43

=== DECISION LOGIC ===
SNR 20kHz band: 2.53 (8.1 dB)
SNR 40kHz band: 4.26 (12.6 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 39957.52 Hz
==============================

Result: 39957 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 20589.11 Hz (bin 253)
  Peak magnitude: 0.50
  Band average: 0.18
  Peak/Average ratio: 2.82

Band 40kHz (37-42 kHz):
  Peak: 38329.93 Hz (bin 471)
  Peak magnitude: 0.39
  Band average: 0.16
  Peak/Average ratio: 2.47

Noise baseline (5-15 kHz):
  Average: 0.18
  Max: 0.63

=== DECISION LOGIC ===
SNR 20kHz band: 2.83 (9.0 dB)
SNR 40kHz band: 2.19 (6.8 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19042.89 Hz (bin 234)
  Peak magnitude: 0.36
  Band average: 0.14
  Peak/Average ratio: 2.47

Band 40kHz (37-42 kHz):
  Peak: 39713.38 Hz (bin 488)
  Peak magnitude: 0.43
  Band average: 0.18
  Peak/Average ratio: 2.41

Noise baseline (5-15 kHz):
  Average: 0.22
  Max: 0.91

=== DECISION LOGIC ===
SNR 20kHz band: 1.62 (4.2 dB)
SNR 40kHz band: 1.96 (5.8 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22542.23 Hz (bin 277)
  Peak magnitude: 2.01
  Band average: 0.58
  Peak/Average ratio: 3.45

Band 40kHz (37-42 kHz):
  Peak: 40934.08 Hz (bin 503)
  Peak magnitude: 2.35
  Band average: 0.77
  Peak/Average ratio: 3.07

Noise baseline (5-15 kHz):
  Average: 0.57
  Max: 1.57

=== DECISION LOGIC ===
SNR 20kHz band: 3.54 (11.0 dB)
SNR 40kHz band: 4.13 (12.3 dB)

Signal detected at 20kHz: YES
Signal detected at 40kHz: YES

==> WARNING: Both frequencies detected!
    Selecting 40 kHz (stronger signal)
==============================

Result: 40934 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21891.19 Hz (bin 269)
  Peak magnitude: 0.47
  Band average: 0.19
  Peak/Average ratio: 2.52

Band 40kHz (37-42 kHz):
  Peak: 40364.42 Hz (bin 496)
  Peak magnitude: 0.42
  Band average: 0.16
  Peak/Average ratio: 2.66

Noise baseline (5-15 kHz):
  Average: 0.19
  Max: 0.59

=== DECISION LOGIC ===
SNR 20kHz band: 2.48 (7.9 dB)
SNR 40kHz band: 2.23 (7.0 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 20263.59 Hz (bin 249)
  Peak magnitude: 0.33
  Band average: 0.16
  Peak/Average ratio: 2.03

Band 40kHz (37-42 kHz):
  Peak: 38492.68 Hz (bin 473)
  Peak magnitude: 0.53
  Band average: 0.16
  Peak/Average ratio: 3.27

Noise baseline (5-15 kHz):
  Average: 0.19
  Max: 0.70

=== DECISION LOGIC ===
SNR 20kHz band: 1.74 (4.8 dB)
SNR 40kHz band: 2.80 (8.9 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 20670.49 Hz (bin 254)
  Peak magnitude: 4.68
  Band average: 1.81
  Peak/Average ratio: 2.59

Band 40kHz (37-42 kHz):
  Peak: 39957.52 Hz (bin 491)
  Peak magnitude: 7.83
  Band average: 2.15
  Peak/Average ratio: 3.65

Noise baseline (5-15 kHz):
  Average: 1.78
  Max: 6.46

=== DECISION LOGIC ===
SNR 20kHz band: 2.63 (8.4 dB)
SNR 40kHz band: 4.40 (12.9 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 39957.52 Hz
==============================

Result: 39957 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21240.15 Hz (bin 261)
  Peak magnitude: 0.34
  Band average: 0.15
  Peak/Average ratio: 2.35

Band 40kHz (37-42 kHz):
  Peak: 39713.38 Hz (bin 488)
  Peak magnitude: 0.37
  Band average: 0.17
  Peak/Average ratio: 2.21

Noise baseline (5-15 kHz):
  Average: 0.18
  Max: 0.72

=== DECISION LOGIC ===
SNR 20kHz band: 1.93 (5.7 dB)
SNR 40kHz band: 2.08 (6.3 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22460.85 Hz (bin 276)
  Peak magnitude: 0.45
  Band average: 0.18
  Peak/Average ratio: 2.53

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.43
  Band average: 0.16
  Peak/Average ratio: 2.72

Noise baseline (5-15 kHz):
  Average: 0.18
  Max: 0.55

=== DECISION LOGIC ===
SNR 20kHz band: 2.55 (8.1 dB)
SNR 40kHz band: 2.47 (7.8 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21647.05 Hz (bin 266)
  Peak magnitude: 5.82
  Band average: 1.86
  Peak/Average ratio: 3.13

Band 40kHz (37-42 kHz):
  Peak: 39957.52 Hz (bin 491)
  Peak magnitude: 5.62
  Band average: 1.82
  Peak/Average ratio: 3.09

Noise baseline (5-15 kHz):
  Average: 1.60
  Max: 5.59

=== DECISION LOGIC ===
SNR 20kHz band: 3.63 (11.2 dB)
SNR 40kHz band: 3.51 (10.9 dB)

Signal detected at 20kHz: YES
Signal detected at 40kHz: YES

==> WARNING: Both frequencies detected!
    Selecting 20 kHz (stronger signal)
==============================

Result: 21647 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21647.05 Hz (bin 266)
  Peak magnitude: 0.37
  Band average: 0.14
  Peak/Average ratio: 2.57

Band 40kHz (37-42 kHz):
  Peak: 37841.64 Hz (bin 465)
  Peak magnitude: 0.45
  Band average: 0.17
  Peak/Average ratio: 2.67

Noise baseline (5-15 kHz):
  Average: 0.19
  Max: 0.61

=== DECISION LOGIC ===
SNR 20kHz band: 1.94 (5.8 dB)
SNR 40kHz band: 2.38 (7.5 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19287.03 Hz (bin 237)
  Peak magnitude: 0.36
  Band average: 0.16
  Peak/Average ratio: 2.26

Band 40kHz (37-42 kHz):
  Peak: 40364.42 Hz (bin 496)
  Peak magnitude: 0.45
  Band average: 0.18
  Peak/Average ratio: 2.50

Noise baseline (5-15 kHz):
  Average: 0.20
  Max: 0.74

=== DECISION LOGIC ===
SNR 20kHz band: 1.84 (5.3 dB)
SNR 40kHz band: 2.29 (7.2 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22623.61 Hz (bin 278)
  Peak magnitude: 4.89
  Band average: 1.43
  Peak/Average ratio: 3.41

Band 40kHz (37-42 kHz):
  Peak: 40934.08 Hz (bin 503)
  Peak magnitude: 5.28
  Band average: 1.59
  Peak/Average ratio: 3.33

Noise baseline (5-15 kHz):
  Average: 1.49
  Max: 5.32

=== DECISION LOGIC ===
SNR 20kHz band: 3.27 (10.3 dB)
SNR 40kHz band: 3.53 (11.0 dB)

Signal detected at 20kHz: YES
Signal detected at 40kHz: YES

==> WARNING: Both frequencies detected!
    Selecting 40 kHz (stronger signal)
==============================

Result: 40934 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19368.41 Hz (bin 238)
  Peak magnitude: 0.31
  Band average: 0.15
  Peak/Average ratio: 2.07

Band 40kHz (37-42 kHz):
  Peak: 40364.42 Hz (bin 496)
  Peak magnitude: 0.44
  Band average: 0.15
  Peak/Average ratio: 2.83

Noise baseline (5-15 kHz):
  Average: 0.18
  Max: 0.67

=== DECISION LOGIC ===
SNR 20kHz band: 1.74 (4.8 dB)
SNR 40kHz band: 2.44 (7.8 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 20996.01 Hz (bin 258)
  Peak magnitude: 0.42
  Band average: 0.15
  Peak/Average ratio: 2.82

Band 40kHz (37-42 kHz):
  Peak: 41015.46 Hz (bin 504)
  Peak magnitude: 0.61
  Band average: 0.16
  Peak/Average ratio: 3.78

Noise baseline (5-15 kHz):
  Average: 0.17
  Max: 0.53

=== DECISION LOGIC ===
SNR 20kHz band: 2.49 (7.9 dB)
SNR 40kHz band: 3.60 (11.1 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 41015.46 Hz
==============================

Result: 41015 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19287.03 Hz (bin 237)
  Peak magnitude: 3.01
  Band average: 1.10
  Peak/Average ratio: 2.74

Band 40kHz (37-42 kHz):
  Peak: 39957.52 Hz (bin 491)
  Peak magnitude: 4.59
  Band average: 1.01
  Peak/Average ratio: 4.53

Noise baseline (5-15 kHz):
  Average: 1.05
  Max: 2.78

=== DECISION LOGIC ===
SNR 20kHz band: 2.85 (9.1 dB)
SNR 40kHz band: 4.36 (12.8 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 39957.52 Hz
==============================

Result: 39957 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21809.81 Hz (bin 268)
  Peak magnitude: 0.32
  Band average: 0.15
  Peak/Average ratio: 2.17

Band 40kHz (37-42 kHz):
  Peak: 40527.18 Hz (bin 498)
  Peak magnitude: 0.41
  Band average: 0.14
  Peak/Average ratio: 3.03

Noise baseline (5-15 kHz):
  Average: 0.21
  Max: 0.67

=== DECISION LOGIC ===
SNR 20kHz band: 1.52 (3.6 dB)
SNR 40kHz band: 1.94 (5.8 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 20507.73 Hz (bin 252)
  Peak magnitude: 0.39
  Band average: 0.13
  Peak/Average ratio: 3.13

Band 40kHz (37-42 kHz):
  Peak: 36946.47 Hz (bin 454)
  Peak magnitude: 0.35
  Band average: 0.13
  Peak/Average ratio: 2.77

Noise baseline (5-15 kHz):
  Average: 0.21
  Max: 0.68

=== DECISION LOGIC ===
SNR 20kHz band: 1.86 (5.4 dB)
SNR 40kHz band: 1.67 (4.4 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19368.41 Hz (bin 238)
  Peak magnitude: 2.52
  Band average: 1.10
  Peak/Average ratio: 2.29

Band 40kHz (37-42 kHz):
  Peak: 38899.59 Hz (bin 478)
  Peak magnitude: 4.09
  Band average: 1.21
  Peak/Average ratio: 3.38

Noise baseline (5-15 kHz):
  Average: 1.23
  Max: 3.74

=== DECISION LOGIC ===
SNR 20kHz band: 2.04 (6.2 dB)
SNR 40kHz band: 3.31 (10.4 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 38899.59 Hz
==============================

Result: 38899 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22542.23 Hz (bin 277)
  Peak magnitude: 0.32
  Band average: 0.15
  Peak/Average ratio: 2.19

Band 40kHz (37-42 kHz):
  Peak: 40364.42 Hz (bin 496)
  Peak magnitude: 0.47
  Band average: 0.16
  Peak/Average ratio: 2.88

Noise baseline (5-15 kHz):
  Average: 0.19
  Max: 0.75

=== DECISION LOGIC ===
SNR 20kHz band: 1.74 (4.8 dB)
SNR 40kHz band: 2.52 (8.0 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22460.85 Hz (bin 276)
  Peak magnitude: 0.39
  Band average: 0.15
  Peak/Average ratio: 2.61

Band 40kHz (37-42 kHz):
  Peak: 38411.30 Hz (bin 472)
  Peak magnitude: 0.46
  Band average: 0.19
  Peak/Average ratio: 2.42

Noise baseline (5-15 kHz):
  Average: 0.21
  Max: 0.61

=== DECISION LOGIC ===
SNR 20kHz band: 1.83 (5.3 dB)
SNR 40kHz band: 2.16 (6.7 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22542.23 Hz (bin 277)
  Peak magnitude: 2.16
  Band average: 0.87
  Peak/Average ratio: 2.50

Band 40kHz (37-42 kHz):
  Peak: 38980.96 Hz (bin 479)
  Peak magnitude: 2.58
  Band average: 0.92
  Peak/Average ratio: 2.81

Noise baseline (5-15 kHz):
  Average: 0.84
  Max: 1.84

=== DECISION LOGIC ===
SNR 20kHz band: 2.59 (8.3 dB)
SNR 40kHz band: 3.09 (9.8 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 38980.96 Hz
==============================

Result: 38980 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21891.19 Hz (bin 269)
  Peak magnitude: 0.01
  Band average: 0.01
  Peak/Average ratio: 1.80

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.78
  Band average: 0.03
  Peak/Average ratio: 29.36

Noise baseline (5-15 kHz):
  Average: 0.01
  Max: 0.02

=== DECISION LOGIC ===
SNR 20kHz band: 1.44 (3.2 dB)
SNR 40kHz band: 75.38 (37.5 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 41585.12 Hz
==============================

Result: 41585 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1084) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1124) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19449.79 Hz (bin 239)
  Peak magnitude: 0.01
  Band average: 0.01
  Peak/Average ratio: 1.98

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.77
  Band average: 0.02
  Peak/Average ratio: 38.80

Noise baseline (5-15 kHz):
  Average: 0.01
  Max: 0.01

=== DECISION LOGIC ===
SNR 20kHz band: 1.82 (5.2 dB)
SNR 40kHz band: 110.47 (40.9 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 41585.12 Hz
==============================

Result: 41585 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1704) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1714) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1724) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1754) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22704.99 Hz (bin 279)
  Peak magnitude: 3.65
  Band average: 1.46
  Peak/Average ratio: 2.51

Band 40kHz (37-42 kHz):
  Peak: 40934.08 Hz (bin 503)
  Peak magnitude: 5.05
  Band average: 1.81
  Peak/Average ratio: 2.79

Noise baseline (5-15 kHz):
  Average: 1.51
  Max: 5.08

=== DECISION LOGIC ===
SNR 20kHz band: 2.42 (7.7 dB)
SNR 40kHz band: 3.34 (10.5 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 40934.08 Hz
==============================

Result: 40934 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2344) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2354) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19531.17 Hz (bin 240)
  Peak magnitude: 0.36
  Band average: 0.16
  Peak/Average ratio: 2.30

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.47
  Band average: 0.18
  Peak/Average ratio: 2.56

Noise baseline (5-15 kHz):
  Average: 0.19
  Max: 0.84

=== DECISION LOGIC ===
SNR 20kHz band: 1.89 (5.5 dB)
SNR 40kHz band: 2.44 (7.8 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22704.99 Hz (bin 279)
  Peak magnitude: 0.01
  Band average: 0.00
  Peak/Average ratio: 2.26

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.77
  Band average: 0.02
  Peak/Average ratio: 45.71

Noise baseline (5-15 kHz):
  Average: 0.00
  Max: 0.01

=== DECISION LOGIC ===
SNR 20kHz band: 1.94 (5.7 dB)
SNR 40kHz band: 210.00 (46.4 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 41585.12 Hz
==============================

Result: 41585 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21728.43 Hz (bin 267)
  Peak magnitude: 2.16
  Band average: 1.03
  Peak/Average ratio: 2.09

Band 40kHz (37-42 kHz):
  Peak: 39957.52 Hz (bin 491)
  Peak magnitude: 5.56
  Band average: 1.48
  Peak/Average ratio: 3.77

Noise baseline (5-15 kHz):
  Average: 1.07
  Max: 4.87

=== DECISION LOGIC ===
SNR 20kHz band: 2.02 (6.1 dB)
SNR 40kHz band: 5.21 (14.3 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 39957.52 Hz
==============================

Result: 39957 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x42009714
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x42009714:0x3fc9e3f0 0x42008fb2:0x3fc9e410 0x42029167:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: eb63220b3

Rebooting...
ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=1722ch ( 94764) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027254 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029d30 vaddr=40374000 size=062e8h ( 25320) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=2a018h (172056) map[0m
[0;32mI (166) esp_image: segment 4: paddr=0005a040 vaddr=4037a2e8 size=0a168h ( 41320) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  eb63220b3...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
