ded app from partitï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0x1 (POWERON),boot:0x8 (SPI_FAST_FLASH_BOOT)
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (27) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (27) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (27) boot: Multicore bootloader[0m
[0;32mI (30) boot: chip revision: v0.2[0m
[0;32mI (34) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (38) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (43) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (48) boot: Enabling RNG early entropy source...[0m
[0;32mI (53) boot: Partition Table:[0m
[0;32mI (57) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (64) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (72) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (79) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (87) boot: End of partition table[0m
[0;32mI (91) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=171ech ( 94700) map[0m
[0;32mI (116) esp_image: segment 1: paddr=00027214 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (119) esp_image: segment 2: paddr=00029cf0 vaddr=40374000 size=06328h ( 25384) load[0m
[0;32mI (128) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=29fc4h (171972) map[0m
[0;32mI (161) esp_image: segment 4: paddr=00059fec vaddr=4037a328 size=0a128h ( 41256) load[0m
[0;32mI (177) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (177) boot: Disabling RNG early entropy source...[0m
[0;32mI (189) cpu_start: Multicore app[0m
[0;32mI (198) cpu_start: Pro cpu start user code[0m
[0;32mI (198) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (199) cpu_start: Application information:[0m
[0;32mI (201) cpu_start: Project name:     esp_node[0m
[0;32mI (206) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (212) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (218) cpu_start: ELF file SHA256:  91622ede4...[0m
[0;32mI (223) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (228) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (233) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (238) cpu_start: Chip rev:         v0.2[0m
[0;32mI (243) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (250) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (256) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (262) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (268) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (275) spi_flash: detected chip: gd[0m
[0;32mI (279) spi_flash: flash io: dio[0m
[0;33mW (283) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (296) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (303) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (310) main_task: Started on CPU0[0m
[0;32mI (320) main_task: Calling app_main()[0m
[0;32mI (320) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (330) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (340) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (340) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (350) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (360) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (370) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (370) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (380) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (390) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (400) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (410) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (420) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (430) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (440) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (450) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (460) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (470) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (480) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (500) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19856.69 Hz (bin 244)
  Peak magnitude: 0.02
  Band average: 0.01
  Peak/Average ratio: 2.22

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.78
  Band average: 0.02
  Peak/Average ratio: 32.86

Noise baseline (5-15 kHz):
  Average: 0.01
  Max: 0.02

=== DECISION LOGIC ===
SNR 20kHz band: 2.43 (7.7 dB)
SNR 40kHz band: 85.24 (38.6 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 41585.12 Hz
==============================

Result: 41585 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1080) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1080) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1090) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1110) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1120) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 18961.51 Hz (bin 233)
  Peak magnitude: 0.01
  Band average: 0.01
  Peak/Average ratio: 1.96

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.78
  Band average: 0.02
  Peak/Average ratio: 42.11

Noise baseline (5-15 kHz):
  Average: 0.01
  Max: 0.01

=== DECISION LOGIC ===
SNR 20kHz band: 1.76 (4.9 dB)
SNR 40kHz band: 125.55 (42.0 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 41585.12 Hz
==============================

Result: 41585 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1700) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1710) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1720) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1730) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1740) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1750) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 20507.73 Hz (bin 252)
  Peak magnitude: 2.20
  Band average: 1.25
  Peak/Average ratio: 1.76

Band 40kHz (37-42 kHz):
  Peak: 39957.52 Hz (bin 491)
  Peak magnitude: 4.48
  Band average: 1.25
  Peak/Average ratio: 3.59

Noise baseline (5-15 kHz):
  Average: 1.21
  Max: 2.27

=== DECISION LOGIC ===
SNR 20kHz band: 1.82 (5.2 dB)
SNR 40kHz band: 3.72 (11.4 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 39957.52 Hz
==============================

Result: 39957 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2330) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2340) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2350) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x420096bc
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x420096bc:0x3fc9e3f0 0x42008fae:0x3fc9e410 0x42029113:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: 91622ede4

Rebooting...
ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=171ech ( 94700) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027214 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029cf0 vaddr=40374000 size=06328h ( 25384) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=29fc4h (171972) map[0m
[0;32mI (166) esp_image: segment 4: paddr=00059fec vaddr=4037a328 size=0a128h ( 41256) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  91622ede4...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21728.43 Hz (bin 267)
  Peak magnitude: 0.37
  Band average: 0.14
  Peak/Average ratio: 2.69

Band 40kHz (37-42 kHz):
  Peak: 40364.42 Hz (bin 496)
  Peak magnitude: 0.46
  Band average: 0.16
  Peak/Average ratio: 2.96

Noise baseline (5-15 kHz):
  Average: 0.20
  Max: 0.75

=== DECISION LOGIC ===
SNR 20kHz band: 1.90 (5.6 dB)
SNR 40kHz band: 2.35 (7.4 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21565.67 Hz (bin 265)
  Peak magnitude: 0.51
  Band average: 0.18
  Peak/Average ratio: 2.78

Band 40kHz (37-42 kHz):
  Peak: 39713.38 Hz (bin 488)
  Peak magnitude: 0.49
  Band average: 0.17
  Peak/Average ratio: 2.82

Noise baseline (5-15 kHz):
  Average: 0.19
  Max: 0.70

=== DECISION LOGIC ===
SNR 20kHz band: 2.69 (8.6 dB)
SNR 40kHz band: 2.56 (8.2 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22216.71 Hz (bin 273)
  Peak magnitude: 2.22
  Band average: 1.25
  Peak/Average ratio: 1.78

Band 40kHz (37-42 kHz):
  Peak: 39957.52 Hz (bin 491)
  Peak magnitude: 6.29
  Band average: 1.59
  Peak/Average ratio: 3.94

Noise baseline (5-15 kHz):
  Average: 1.37
  Max: 3.33

=== DECISION LOGIC ===
SNR 20kHz band: 1.61 (4.2 dB)
SNR 40kHz band: 4.58 (13.2 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 39957.52 Hz
==============================

Result: 39957 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x420096bc
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x420096bc:0x3fc9e3f0 0x42008fae:0x3fc9e410 0x42029113:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: 91622ede4

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=171ech ( 94700) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027214 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029cf0 vaddr=40374000 size=06328h ( 25384) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=29fc4h (171972) map[0m
[0;32mI (166) esp_image: segment 4: paddr=00059fec vaddr=4037a328 size=0a128h ( 41256) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  91622ede4...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21158.77 Hz (bin 260)
  Peak magnitude: 0.32
  Band average: 0.15
  Peak/Average ratio: 2.14

Band 40kHz (37-42 kHz):
  Peak: 40364.42 Hz (bin 496)
  Peak magnitude: 0.44
  Band average: 0.20
  Peak/Average ratio: 2.23

Noise baseline (5-15 kHz):
  Average: 0.19
  Max: 0.60

=== DECISION LOGIC ===
SNR 20kHz band: 1.66 (4.4 dB)
SNR 40kHz band: 2.30 (7.2 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19531.17 Hz (bin 240)
  Peak magnitude: 0.27
  Band average: 0.13
  Peak/Average ratio: 2.02

Band 40kHz (37-42 kHz):
  Peak: 39713.38 Hz (bin 488)
  Peak magnitude: 0.42
  Band average: 0.15
  Peak/Average ratio: 2.78

Noise baseline (5-15 kHz):
  Average: 0.16
  Max: 0.59

=== DECISION LOGIC ===
SNR 20kHz band: 1.69 (4.5 dB)
SNR 40kHz band: 2.60 (8.3 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21647.05 Hz (bin 266)
  Peak magnitude: 1.65
  Band average: 0.79
  Peak/Average ratio: 2.08

Band 40kHz (37-42 kHz):
  Peak: 36946.47 Hz (bin 454)
  Peak magnitude: 1.65
  Band average: 0.81
  Peak/Average ratio: 2.03

Noise baseline (5-15 kHz):
  Average: 0.84
  Max: 1.59

=== DECISION LOGIC ===
SNR 20kHz band: 1.97 (5.9 dB)
SNR 40kHz band: 1.97 (5.9 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x420096bc
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x420096bc:0x3fc9e3f0 0x42008fae:0x3fc9e410 0x42029113:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: 91622ede4

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=171ech ( 94700) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027214 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029cf0 vaddr=40374000 size=06328h ( 25384) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=29fc4h (171972) map[0m
[0;32mI (166) esp_image: segment 4: paddr=00059fec vaddr=4037a328 size=0a128h ( 41256) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  91622ede4...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19287.03 Hz (bin 237)
  Peak magnitude: 0.30
  Band average: 0.12
  Peak/Average ratio: 2.42

Band 40kHz (37-42 kHz):
  Peak: 40364.42 Hz (bin 496)
  Peak magnitude: 0.41
  Band average: 0.15
  Peak/Average ratio: 2.75

Noise baseline (5-15 kHz):
  Average: 0.17
  Max: 0.73

=== DECISION LOGIC ===
SNR 20kHz band: 1.72 (4.7 dB)
SNR 40kHz band: 2.35 (7.4 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1074) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1104) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21972.57 Hz (bin 270)
  Peak magnitude: 0.41
  Band average: 0.16
  Peak/Average ratio: 2.51

Band 40kHz (37-42 kHz):
  Peak: 41015.46 Hz (bin 504)
  Peak magnitude: 0.56
  Band average: 0.18
  Peak/Average ratio: 3.15

Noise baseline (5-15 kHz):
  Average: 0.20
  Max: 0.72

=== DECISION LOGIC ===
SNR 20kHz band: 2.05 (6.2 dB)
SNR 40kHz band: 2.77 (8.8 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1694) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1704) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1714) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1724) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22460.85 Hz (bin 276)
  Peak magnitude: 0.92
  Band average: 0.52
  Peak/Average ratio: 1.76

Band 40kHz (37-42 kHz):
  Peak: 40608.56 Hz (bin 499)
  Peak magnitude: 1.70
  Band average: 0.63
  Peak/Average ratio: 2.70

Noise baseline (5-15 kHz):
  Average: 0.64
  Max: 1.73

=== DECISION LOGIC ===
SNR 20kHz band: 1.42 (3.1 dB)
SNR 40kHz band: 2.63 (8.4 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2324) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2344) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x420096bc
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x420096bc:0x3fc9e3f0 0x42008fae:0x3fc9e410 0x42029113:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: 91622ede4

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=171ech ( 94700) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027214 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029cf0 vaddr=40374000 size=06328h ( 25384) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=29fc4h (171972) map[0m
[0;32mI (166) esp_image: segment 4: paddr=00059fec vaddr=4037a328 size=0a128h ( 41256) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  91622ede4...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19531.17 Hz (bin 240)
  Peak magnitude: 0.01
  Band average: 0.01
  Peak/Average ratio: 1.66

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.78
  Band average: 0.02
  Peak/Average ratio: 41.02

Noise baseline (5-15 kHz):
  Average: 0.01
  Max: 0.01

=== DECISION LOGIC ===
SNR 20kHz band: 1.64 (4.3 dB)
SNR 40kHz band: 143.02 (43.1 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 41585.12 Hz
==============================

Result: 41585 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1084) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1124) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22460.85 Hz (bin 276)
  Peak magnitude: 0.01
  Band average: 0.01
  Peak/Average ratio: 1.80

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.78
  Band average: 0.02
  Peak/Average ratio: 40.20

Noise baseline (5-15 kHz):
  Average: 0.01
  Max: 0.01

=== DECISION LOGIC ===
SNR 20kHz band: 1.88 (5.5 dB)
SNR 40kHz band: 142.45 (43.1 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 41585.12 Hz
==============================

Result: 41585 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1704) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1714) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1724) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1754) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19938.07 Hz (bin 245)
  Peak magnitude: 0.19
  Band average: 0.15
  Peak/Average ratio: 1.29

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.90
  Band average: 0.15
  Peak/Average ratio: 5.95

Noise baseline (5-15 kHz):
  Average: 0.14
  Max: 0.19

=== DECISION LOGIC ===
SNR 20kHz band: 1.35 (2.6 dB)
SNR 40kHz band: 6.37 (16.1 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 41585.12 Hz
==============================

Result: 41585 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2344) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2354) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x420096bc
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x420096bc:0x3fc9e3f0 0x42008fae:0x3fc9e410 0x42029113:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: 91622ede4

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=171ech ( 94700) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027214 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029cf0 vaddr=40374000 size=06328h ( 25384) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=29fc4h (171972) map[0m
[0;32mI (166) esp_image: segment 4: paddr=00059fec vaddr=4037a328 size=0a128h ( 41256) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  91622ede4...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21728.43 Hz (bin 267)
  Peak magnitude: 0.01
  Band average: 0.01
  Peak/Average ratio: 1.82

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.78
  Band average: 0.02
  Peak/Average ratio: 40.09

Noise baseline (5-15 kHz):
  Average: 0.01
  Max: 0.01

=== DECISION LOGIC ===
SNR 20kHz band: 1.77 (5.0 dB)
SNR 40kHz band: 134.26 (42.6 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 41585.12 Hz
==============================

Result: 41585 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1084) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1124) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 20263.59 Hz (bin 249)
  Peak magnitude: 0.01
  Band average: 0.00
  Peak/Average ratio: 1.50

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.78
  Band average: 0.02
  Peak/Average ratio: 44.89

Noise baseline (5-15 kHz):
  Average: 0.00
  Max: 0.01

=== DECISION LOGIC ===
SNR 20kHz band: 1.66 (4.4 dB)
SNR 40kHz band: 191.35 (45.6 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 41585.12 Hz
==============================

Result: 41585 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1704) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1714) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1724) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1754) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 21321.53 Hz (bin 262)
  Peak magnitude: 0.72
  Band average: 0.58
  Peak/Average ratio: 1.24

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.79
  Band average: 0.71
  Peak/Average ratio: 1.12

Noise baseline (5-15 kHz):
  Average: 0.53
  Max: 0.82

=== DECISION LOGIC ===
SNR 20kHz band: 1.36 (2.7 dB)
SNR 40kHz band: 1.49 (3.4 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2344) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2354) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x420096bc
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x420096bc:0x3fc9e3f0 0x42008fae:0x3fc9e410 0x42029113:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: 91622ede4

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=171ech ( 94700) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027214 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029cf0 vaddr=40374000 size=06328h ( 25384) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=29fc4h (171972) map[0m
[0;32mI (166) esp_image: segment 4: paddr=00059fec vaddr=4037a328 size=0a128h ( 41256) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  91622ede4...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22867.75 Hz (bin 281)
  Peak magnitude: 0.00
  Band average: 0.00
  Peak/Average ratio: 2.22

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.78
  Band average: 0.01
  Peak/Average ratio: 56.24

Noise baseline (5-15 kHz):
  Average: 0.00
  Max: 0.00

=== DECISION LOGIC ===
SNR 20kHz band: 2.03 (6.1 dB)
SNR 40kHz band: 1520.40 (63.6 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 41585.12 Hz
==============================

Result: 41585 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1084) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1124) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 22542.23 Hz (bin 277)
  Peak magnitude: 0.02
  Band average: 0.01
  Peak/Average ratio: 2.00

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.78
  Band average: 0.03
  Peak/Average ratio: 29.29

Noise baseline (5-15 kHz):
  Average: 0.01
  Max: 0.03

=== DECISION LOGIC ===
SNR 20kHz band: 1.84 (5.3 dB)
SNR 40kHz band: 65.09 (36.3 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 41585.12 Hz
==============================

Result: 41585 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1704) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1714) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1724) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1754) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 20426.35 Hz (bin 251)
  Peak magnitude: 1.15
  Band average: 0.55
  Peak/Average ratio: 2.09

Band 40kHz (37-42 kHz):
  Peak: 39957.52 Hz (bin 491)
  Peak magnitude: 1.12
  Band average: 0.49
  Peak/Average ratio: 2.29

Noise baseline (5-15 kHz):
  Average: 0.55
  Max: 1.17

=== DECISION LOGIC ===
SNR 20kHz band: 2.09 (6.4 dB)
SNR 40kHz band: 2.03 (6.2 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: NO

==> NO VIBRATION DETECTED (0 Hz)
==============================

Result: 0 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2344) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2354) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x420096bc
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x420096bc:0x3fc9e3f0 0x42008fae:0x3fc9e410 0x42029113:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: 91622ede4

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=171ech ( 94700) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027214 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029cf0 vaddr=40374000 size=06328h ( 25384) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=29fc4h (171972) map[0m
[0;32mI (166) esp_image: segment 4: paddr=00059fec vaddr=4037a328 size=0a128h ( 41256) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  91622ede4...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19938.07 Hz (bin 245)
  Peak magnitude: 0.01
  Band average: 0.00
  Peak/Average ratio: 2.10

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.77
  Band average: 0.02
  Peak/Average ratio: 46.10

Noise baseline (5-15 kHz):
  Average: 0.00
  Max: 0.01

=== DECISION LOGIC ===
SNR 20kHz band: 2.25 (7.0 dB)
SNR 40kHz band: 244.21 (47.8 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 41585.12 Hz
==============================

Result: 41585 Hz

--- Test 2: 20kHz input ONLY (no burst) ---
[0;32mI (1084) PWM: Cambio frequenza: 40000 -> 21700 Hz, risoluzione: 8 -> 9 bit[0m
[0;32mI (1084) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1094) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1114) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (1124) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 19856.69 Hz (bin 244)
  Peak magnitude: 0.01
  Band average: 0.00
  Peak/Average ratio: 1.99

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.78
  Band average: 0.02
  Peak/Average ratio: 48.30

Noise baseline (5-15 kHz):
  Average: 0.00
  Max: 0.01

=== DECISION LOGIC ===
SNR 20kHz band: 2.19 (6.8 dB)
SNR 40kHz band: 310.05 (49.8 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 41585.12 Hz
==============================

Result: 41585 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1704) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m

--- Test 3: 20kHz input + burst ---
[0;32mI (1714) PWM: Cambio frequenza: 21700 -> 21700 Hz, risoluzione: 9 -> 9 bit[0m
[0;32mI (1724) PWM: Timer riconfigurato: 21700 Hz, 9 bit (512 livelli)[0m
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (1734) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 256 / 512 (risoluzione: 9 bit)
[0;32mI (1744) PWM: Hardware PWM duty: 50.00% richiesto -> 50.10% effettivo (256/512)[0m
Imposto duty: 8192 / 16384 (risoluzione: 14 bit)
[0;32mI (1754) PWM: Hardware PWM duty: 50.00% richiesto -> 50.00% effettivo (8192/16384)[0m

=== FREQUENCY BAND ANALYSIS ===
Band 20kHz (19-23 kHz):
  Peak: 20670.49 Hz (bin 254)
  Peak magnitude: 0.27
  Band average: 0.13
  Peak/Average ratio: 2.18

Band 40kHz (37-42 kHz):
  Peak: 41585.12 Hz (bin 511)
  Peak magnitude: 0.78
  Band average: 0.15
  Peak/Average ratio: 5.27

Noise baseline (5-15 kHz):
  Average: 0.13
  Max: 0.30

=== DECISION LOGIC ===
SNR 20kHz band: 2.17 (6.7 dB)
SNR 40kHz band: 6.19 (15.8 dB)

Signal detected at 20kHz: NO
Signal detected at 40kHz: YES

==> DETECTED: 40 kHz TRANSDUCER ACTIVE
    Frequency: 41585.12 Hz
==============================

Result: 41585 Hz
Imposto duty: 0 / 512 (risoluzione: 9 bit)
[0;32mI (2334) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/512)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (2344) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

=====================================
[0;31mE (2354) adc_continuous: adc_continuous_stop(403): The driver is already stopped[0m
ESP_ERROR_CHECK failed: esp_err_t 0x103 (ESP_ERR_INVALID_STATE) at 0x420096bc
file: "./components/frequency/fft_wrapper.cpp" line 12
func: FFT_ultrasonic::~FFT_ultrasonic()
expression: adc_continuous_stop(_handle)

abort() was called at PC 0x4037b41b on core 0


Backtrace: 0x40375a56:0x3fc9e310 0x4037b425:0x3fc9e330 0x403822bd:0x3fc9e350 0x4037b41b:0x3fc9e3c0 0x420096bc:0x3fc9e3f0 0x42008fae:0x3fc9e410 0x42029113:0x3fc9e450 0x4037bd8d:0x3fc9e480




ELF file SHA256: 91622ede4

Rebooting...
ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327
Build:Mar 27 2021
rst:0xc (RTC_SW_CPU_RST),boot:0x8 (SPI_FAST_FLASH_BOOT)
Saved PC:0x403759cc
SPIWP:0xee
mode:DIO, clock div:1
load:0x3fce3810,len:0x178c
load:0x403c9700,len:0x4
load:0x403c9704,len:0xcbc
load:0x403cc700,len:0x2d9c
entry 0x403c9914
[0;32mI (31) boot: ESP-IDF v5.2.2 2nd stage bootloader[0m
[0;32mI (31) boot: compile time Oct 17 2025 19:46:11[0m
[0;32mI (31) boot: Multicore bootloader[0m
[0;32mI (34) boot: chip revision: v0.2[0m
[0;32mI (38) boot.esp32s3: Boot SPI Speed : 80MHz[0m
[0;32mI (43) boot.esp32s3: SPI Mode       : DIO[0m
[0;32mI (48) boot.esp32s3: SPI Flash Size : 2MB[0m
[0;32mI (52) boot: Enabling RNG early entropy source...[0m
[0;32mI (58) boot: Partition Table:[0m
[0;32mI (61) boot: ## Label            Usage          Type ST Offset   Length[0m
[0;32mI (69) boot:  0 nvs              WiFi data        01 02 00009000 00006000[0m
[0;32mI (76) boot:  1 phy_init         RF data          01 01 0000f000 00001000[0m
[0;32mI (84) boot:  2 factory          factory app      00 00 00010000 00177000[0m
[0;32mI (91) boot: End of partition table[0m
[0;32mI (95) esp_image: segment 0: paddr=00010020 vaddr=3c030020 size=171ech ( 94700) map[0m
[0;32mI (121) esp_image: segment 1: paddr=00027214 vaddr=3fc94500 size=02ad4h ( 10964) load[0m
[0;32mI (123) esp_image: segment 2: paddr=00029cf0 vaddr=40374000 size=06328h ( 25384) load[0m
[0;32mI (132) esp_image: segment 3: paddr=00030020 vaddr=42000020 size=29fc4h (171972) map[0m
[0;32mI (166) esp_image: segment 4: paddr=00059fec vaddr=4037a328 size=0a128h ( 41256) load[0m
[0;32mI (182) boot: Loaded app from partition at offset 0x10000[0m
[0;32mI (182) boot: Disabling RNG early entropy source...[0m
[0;32mI (193) cpu_start: Multicore app[0m
[0;32mI (203) cpu_start: Pro cpu start user code[0m
[0;32mI (203) cpu_start: cpu freq: 160000000 Hz[0m
[0;32mI (203) cpu_start: Application information:[0m
[0;32mI (206) cpu_start: Project name:     esp_node[0m
[0;32mI (211) cpu_start: App version:      5129bb6-dirty[0m
[0;32mI (216) cpu_start: Compile time:     Oct 17 2025 19:46:08[0m
[0;32mI (222) cpu_start: ELF file SHA256:  91622ede4...[0m
[0;32mI (228) cpu_start: ESP-IDF:          v5.2.2[0m
[0;32mI (233) cpu_start: Min chip rev:     v0.0[0m
[0;32mI (237) cpu_start: Max chip rev:     v0.99 [0m
[0;32mI (242) cpu_start: Chip rev:         v0.2[0m
[0;32mI (247) heap_init: Initializing. RAM available for dynamic allocation:[0m
[0;32mI (254) heap_init: At 3FC979E0 len 00051D30 (327 KiB): RAM[0m
[0;32mI (260) heap_init: At 3FCE9710 len 00005724 (21 KiB): RAM[0m
[0;32mI (266) heap_init: At 3FCF0000 len 00008000 (32 KiB): DRAM[0m
[0;32mI (273) heap_init: At 600FE010 len 00001FD8 (7 KiB): RTCRAM[0m
[0;32mI (280) spi_flash: detected chip: gd[0m
[0;32mI (283) spi_flash: flash io: dio[0m
[0;33mW (287) spi_flash: Detected size(8192k) larger than the size in the binary image header(2048k). Using the size in the binary image header.[0m
[0;32mI (301) sleep: Configure to isolate all GPIO pins in sleep state[0m
[0;32mI (307) sleep: Enable automatic switching of GPIO sleep configuration[0m
[0;32mI (314) main_task: Started on CPU0[0m
[0;32mI (324) main_task: Calling app_main()[0m
[0;32mI (324) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (334) PWM: PWM inizializzato: GPIO 2, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (344) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (344) PWM: PWM inizializzato: GPIO 3, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (354) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (364) PWM: PWM inizializzato: GPIO 4, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (374) PWM: Risoluzione ottimale calcolata: 8 bit per frequenza 40000 Hz[0m
[0;32mI (374) PWM: PWM inizializzato: GPIO 1, Freq 40000 Hz, Risoluzione 8 bit (256 livelli)[0m
[0;32mI (384) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (394) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (404) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
[0;32mI (414) PWM: Cambio frequenza: 40000 -> 1000 Hz, risoluzione: 8 -> 14 bit[0m
[0;32mI (424) PWM: Timer riconfigurato: 1000 Hz, 14 bit (16384 livelli)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (434) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m

========== DIAGNOSTIC TEST ==========
[0;32mI (444) FFT: sampling rate too high, the maximum sampling rate will be used: 83333[0m
[0;32mI (454) gpio: GPIO[7]| InputEn: 0| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m

--- Test 1: All OFF ---
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (464) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 256 (risoluzione: 8 bit)
[0;32mI (474) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/256)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (484) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
Imposto duty: 0 / 16384 (risoluzione: 14 bit)
[0;32mI (504) PWM: Hardware PWM duty: 0.00% richiesto -> 0.00% effettivo (0/16384)[0m
